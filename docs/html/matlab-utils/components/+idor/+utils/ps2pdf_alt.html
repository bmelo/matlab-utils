<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ps2pdf_alt</title>
  <meta name="keywords" content="ps2pdf_alt">
  <meta name="description" content="PS2PDF Function to convert a PostScript file to PDF using Ghostscript">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../../menu.html matlab-utils --><!-- ../../menu.html components --><!-- # +idor --><!-- menu.html +utils -->
<h1>ps2pdf_alt
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>PS2PDF Function to convert a PostScript file to PDF using Ghostscript</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function ps2pdf_alt(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">PS2PDF Function to convert a PostScript file to PDF using Ghostscript

  Converts a postscript file into PDF. The resulting PDF file will contain
  one page for each page defined in the postscript files, so a multi-page
  postscript file, like those generated by using the '-append' option of 
  MATLAB's print command, can be used to generate a multi-page PDF file. 

   Ghostscript is a third-party application currently supplied with 
   MATLAB. The caller may also specify a different version of Ghostscript
   to use.

   PS2PDF expects to be called with a set of parameter-value pairs. The
   order of these is unimportant, but required parameters MUST be
   specified

   In the list below, required parameters are marked with an asterisk *
        NOTE: ps2pdf can not use MATLAB's version of Ghostscript
              in a deployed application; you MUST provide a 
              the path to a separate instance of Ghostscript. This 
              parameter is marked with a double asterisk **

   Parameter:        Value:  
   *  psfile         full or relative path to the postscript file to convert

   *  pdffile        full or relative path to the pdf file to create

   ** gscommand      path to Ghostscript executable to use; this will try
                     to default to the version of Ghostscript shipped with 
                     MATLAB, if any. If this value is specified you should 
                     also specify the gsfontpath and gslibpath values.

                     ** See note on deployed applications, above.

      gsfontpath     full path to the Ghostscript font files
                     If a gscommand is specified then this path should
                     also be specified and reference the same Ghostscript
                     version

      gslibpath      full path to the Ghostscript library (.ps) files. 
                     If a gscommand is specified then this path should
                     also be specified and reference the same Ghostscript
                     version

                     If gscommand is NOT specified and we can determine
                     the version of Ghostscript, if any, shipped with
                     MATLAB, then this value will be overridden to use the
                     path that references MATLAB's version of Ghostscript

      gspapersize    paper size to use in the created .pdf file. If not 
                     specified or the specified value is not recognized 
                     it will use whatever default paper size is 
                     built into the version of Ghostscript being run

                         NOTE: no scaling of the input occurs - it's simply
                         placed on a page with the specified paper size. 

                         Valid values for gspapersize are: 
                              'letter', 'ledger', 'legal', '11x17', 
                              'archA', 'archB', 'archC', 'archD', 'archE', 
                              'a0', 'a1', 'a2', 'a3','a4', 'a5',
                              'a6', 'a7', 'a8', 'a9', 'a10'
                         
      deletepsfile   0 to keep the input ps file after creating pdf
                     non-zero to delete the input ps file after creating pdf
                     Default is 0: keep the input ps file (do NOT delete it)
                        NOTE: if the pdf creation process fails, the input
                        PS file will be kept regardless of this setting

      verbose        0 to suppress display of status/progress info; 
                     non-zero to allow display of status/progress info
                     Default is 0 (no display)

 Example usage: 
    use MATLAB's version of Ghostscript to generate an A4 pdf file
      ps2pdf('psfile', 'input.ps', 'pdffile', 'output.pdf', 'gspapersize', 'a4')

    use a local copy of Ghostcript to generate a file, and display some 
    status/progress info while doing so.
      ps2pdf('psfile', '../reports/input.ps', 'pdffile', 'c:\temp\output3.pdf', ...
            'gspapersize', 'a4', 'verbose', 1, ...
            'gscommand', 'C:\Program Files\GhostScript\bin\gswin32c.exe', ...
            'gsfontpath', 'C:\Program Files\GhostScript\fonts', ...
            'gslibpath', 'C:\Program Files\GhostScript\lib')

    use MATLAB's version of Ghostscript to generate a pdf file and delete
    the input.ps file when done 
      ps2pdf('psfile', 'input.ps', 'pdffile', 'output.pdf', 'gspapersize', 'a4', 'deletepsfile', 1)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="ps2pdf.html" class="code" title="function filename = ps2pdf( filename )">ps2pdf</a>	PS2PDF Function to convert a PostScript file to PDF using Ghostscript</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function gsData = LocalParseArgs(varargin)</a></li><li><a href="#_sub2" class="code">function gsData = LocalCreateResponseFile(gsData)</a></li><li><a href="#_sub3" class="code">function gs = Local_GetGscriptFcnHandle()</a></li><li><a href="#_sub4" class="code">function [gsCmd, ghostDir] = Local_GetOldGhostscript</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function ps2pdf_alt(varargin)</a>
0002 <span class="comment">%PS2PDF Function to convert a PostScript file to PDF using Ghostscript</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%  Converts a postscript file into PDF. The resulting PDF file will contain</span>
0005 <span class="comment">%  one page for each page defined in the postscript files, so a multi-page</span>
0006 <span class="comment">%  postscript file, like those generated by using the '-append' option of</span>
0007 <span class="comment">%  MATLAB's print command, can be used to generate a multi-page PDF file.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%   Ghostscript is a third-party application currently supplied with</span>
0010 <span class="comment">%   MATLAB. The caller may also specify a different version of Ghostscript</span>
0011 <span class="comment">%   to use.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%   PS2PDF expects to be called with a set of parameter-value pairs. The</span>
0014 <span class="comment">%   order of these is unimportant, but required parameters MUST be</span>
0015 <span class="comment">%   specified</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%   In the list below, required parameters are marked with an asterisk *</span>
0018 <span class="comment">%        NOTE: ps2pdf can not use MATLAB's version of Ghostscript</span>
0019 <span class="comment">%              in a deployed application; you MUST provide a</span>
0020 <span class="comment">%              the path to a separate instance of Ghostscript. This</span>
0021 <span class="comment">%              parameter is marked with a double asterisk **</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%   Parameter:        Value:</span>
0024 <span class="comment">%   *  psfile         full or relative path to the postscript file to convert</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   *  pdffile        full or relative path to the pdf file to create</span>
0027 <span class="comment">%</span>
0028 <span class="comment">%   ** gscommand      path to Ghostscript executable to use; this will try</span>
0029 <span class="comment">%                     to default to the version of Ghostscript shipped with</span>
0030 <span class="comment">%                     MATLAB, if any. If this value is specified you should</span>
0031 <span class="comment">%                     also specify the gsfontpath and gslibpath values.</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%                     ** See note on deployed applications, above.</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%      gsfontpath     full path to the Ghostscript font files</span>
0036 <span class="comment">%                     If a gscommand is specified then this path should</span>
0037 <span class="comment">%                     also be specified and reference the same Ghostscript</span>
0038 <span class="comment">%                     version</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%      gslibpath      full path to the Ghostscript library (.ps) files.</span>
0041 <span class="comment">%                     If a gscommand is specified then this path should</span>
0042 <span class="comment">%                     also be specified and reference the same Ghostscript</span>
0043 <span class="comment">%                     version</span>
0044 <span class="comment">%</span>
0045 <span class="comment">%                     If gscommand is NOT specified and we can determine</span>
0046 <span class="comment">%                     the version of Ghostscript, if any, shipped with</span>
0047 <span class="comment">%                     MATLAB, then this value will be overridden to use the</span>
0048 <span class="comment">%                     path that references MATLAB's version of Ghostscript</span>
0049 <span class="comment">%</span>
0050 <span class="comment">%      gspapersize    paper size to use in the created .pdf file. If not</span>
0051 <span class="comment">%                     specified or the specified value is not recognized</span>
0052 <span class="comment">%                     it will use whatever default paper size is</span>
0053 <span class="comment">%                     built into the version of Ghostscript being run</span>
0054 <span class="comment">%</span>
0055 <span class="comment">%                         NOTE: no scaling of the input occurs - it's simply</span>
0056 <span class="comment">%                         placed on a page with the specified paper size.</span>
0057 <span class="comment">%</span>
0058 <span class="comment">%                         Valid values for gspapersize are:</span>
0059 <span class="comment">%                              'letter', 'ledger', 'legal', '11x17',</span>
0060 <span class="comment">%                              'archA', 'archB', 'archC', 'archD', 'archE',</span>
0061 <span class="comment">%                              'a0', 'a1', 'a2', 'a3','a4', 'a5',</span>
0062 <span class="comment">%                              'a6', 'a7', 'a8', 'a9', 'a10'</span>
0063 <span class="comment">%</span>
0064 <span class="comment">%      deletepsfile   0 to keep the input ps file after creating pdf</span>
0065 <span class="comment">%                     non-zero to delete the input ps file after creating pdf</span>
0066 <span class="comment">%                     Default is 0: keep the input ps file (do NOT delete it)</span>
0067 <span class="comment">%                        NOTE: if the pdf creation process fails, the input</span>
0068 <span class="comment">%                        PS file will be kept regardless of this setting</span>
0069 <span class="comment">%</span>
0070 <span class="comment">%      verbose        0 to suppress display of status/progress info;</span>
0071 <span class="comment">%                     non-zero to allow display of status/progress info</span>
0072 <span class="comment">%                     Default is 0 (no display)</span>
0073 <span class="comment">%</span>
0074 <span class="comment">% Example usage:</span>
0075 <span class="comment">%    use MATLAB's version of Ghostscript to generate an A4 pdf file</span>
0076 <span class="comment">%      ps2pdf('psfile', 'input.ps', 'pdffile', 'output.pdf', 'gspapersize', 'a4')</span>
0077 <span class="comment">%</span>
0078 <span class="comment">%    use a local copy of Ghostcript to generate a file, and display some</span>
0079 <span class="comment">%    status/progress info while doing so.</span>
0080 <span class="comment">%      ps2pdf('psfile', '../reports/input.ps', 'pdffile', 'c:\temp\output3.pdf', ...</span>
0081 <span class="comment">%            'gspapersize', 'a4', 'verbose', 1, ...</span>
0082 <span class="comment">%            'gscommand', 'C:\Program Files\GhostScript\bin\gswin32c.exe', ...</span>
0083 <span class="comment">%            'gsfontpath', 'C:\Program Files\GhostScript\fonts', ...</span>
0084 <span class="comment">%            'gslibpath', 'C:\Program Files\GhostScript\lib')</span>
0085 <span class="comment">%</span>
0086 <span class="comment">%    use MATLAB's version of Ghostscript to generate a pdf file and delete</span>
0087 <span class="comment">%    the input.ps file when done</span>
0088 <span class="comment">%      ps2pdf('psfile', 'input.ps', 'pdffile', 'output.pdf', 'gspapersize', 'a4', 'deletepsfile', 1)</span>
0089 
0090 <span class="comment">%   Update log:</span>
0091 <span class="comment">%      Jun 16, 2010: added check for deployed application</span>
0092 <span class="comment">%      May 19, 2010: wrapped filenames sent to Ghostscript in quotes</span>
0093 <span class="comment">%      May 06, 2010: updated how Ghostscript is found, don't rely on MATLAB version #</span>
0094 <span class="comment">%      Aug 15, 2008: fixed bug where embedded space in location of</span>
0095 <span class="comment">%                    MATLAB's version of Ghostscript caused ps2pdf to fail.</span>
0096 <span class="comment">%      Apr 16, 2008: added deletepsfile option</span>
0097 
0098 <span class="comment">%   Copyright 2008-2010 The MathWorks, Inc.</span>
0099 
0100    <span class="keyword">if</span> nargin &lt; 1 
0101       error(<span class="string">'ps2pdf:parameters'</span>, <span class="string">'No parameters specified. Type ''help ps2pdf'' for details on how to use this function.'</span>);
0102    <span class="keyword">end</span>
0103 
0104    <span class="comment">% parse input args</span>
0105    gsData = <a href="#_sub1" class="code" title="subfunction gsData = LocalParseArgs(varargin)">LocalParseArgs</a>(varargin{:});
0106 
0107    <span class="comment">% setup the file that tells GS what we want it to do</span>
0108    gsData = <a href="#_sub2" class="code" title="subfunction gsData = LocalCreateResponseFile(gsData)">LocalCreateResponseFile</a>(gsData); 
0109 
0110    gsDebug = 0;
0111    <span class="keyword">if</span> gsData.verbose 
0112       fprintf(<span class="string">'ps2pdf: input settings are:\n'</span>);
0113       <span class="keyword">if</span> isfield(gsData, <span class="string">'paperSizes'</span>)
0114           gsData = rmfield(gsData, <span class="string">'paperSizes'</span>);
0115       <span class="keyword">end</span>
0116       gsData  <span class="comment">%#ok&lt;NOPRT&gt;</span>
0117       fprintf(<span class="string">'ps2pdf: response file for Ghostscript is:\n'</span>);
0118       type(gsData.responseFile);
0119       gsDebug = 1;
0120    <span class="keyword">end</span>
0121 
0122    <span class="comment">%to hold results/status from system call</span>
0123    s = 0; <span class="comment">%#ok&lt;NASGU&gt;</span>
0124    r = <span class="string">''</span>; <span class="comment">%#ok&lt;NASGU&gt;</span>
0125 
0126    <span class="comment">% run Ghostscript to convert the file</span>
0127    <span class="keyword">if</span> gsData.useBuiltin 
0128       [s, r] = gsData.cmd([<span class="string">'@'</span> gsData.responseFile], gsData.psFile, gsDebug);
0129    <span class="keyword">else</span> 
0130       [s, r] = system([gsData.cmd <span class="string">' @&quot;'</span> gsData.responseFile <span class="string">'&quot; &quot;'</span> gsData.psFile <span class="string">'&quot;'</span>]);
0131    <span class="keyword">end</span>
0132 
0133    <span class="keyword">if</span> gsData.verbose
0134       disp( [<span class="string">'Ghostscript STDOUT: '</span> num2str(s) ] );
0135       disp( [<span class="string">'Ghostscript STDERR: '</span> r ] );
0136    <span class="keyword">else</span>
0137       delete(gsData.responseFile)
0138    <span class="keyword">end</span>
0139 
0140    <span class="keyword">if</span> s &amp;&amp; ~isempty(r)
0141       error(<span class="string">'ps2pdf:ghostscript'</span>,  [<span class="string">'Problem converting PostScript. System returned error: '</span> num2str(s) <span class="string">'.'</span> r]) 
0142    <span class="keyword">elseif</span> s
0143       error(<span class="string">'ps2pdf:ghostscript'</span>,  [<span class="string">'Problem calling GhostScript. System returned error: '</span> num2str(s)]) 
0144    <span class="keyword">end</span>
0145 
0146    <span class="comment">%if after all this we still couldn't create the file, report the error</span>
0147    fid = fopen( gsData.pdfFile, <span class="string">'r'</span>);
0148    <span class="keyword">if</span> ( fid == -1 )
0149       error(<span class="string">'ps2pdf:ghostscript'</span>, <span class="string">'%s'</span>, [ <span class="string">'Ghostscript could not create '''</span> gsData.pfdFile <span class="string">'''.'</span> ])
0150    <span class="keyword">else</span>
0151       fclose( fid );
0152    <span class="keyword">end</span>
0153 
0154    <span class="comment">% if we get here, we successfully created pdf file; delete ps file if</span>
0155    <span class="comment">% requested to do so</span>
0156    <span class="keyword">if</span> gsData.deletePSFile 
0157        delete(gsData.psFile);
0158    <span class="keyword">end</span>
0159 
0160 <span class="keyword">end</span>
0161 
0162 <span class="comment">%local function to parse arguments and fill in the gsData structure</span>
0163 <span class="comment">%  .psFile - postscript file to convert</span>
0164 <span class="comment">%  .pdfFile - pdf file to create</span>
0165 <span class="comment">%  .cmd     - path/name of Ghostscript command to run or handle to gscript</span>
0166 <span class="comment">%             builtin</span>
0167 <span class="comment">%  .useBuiltin - 1 if using builtin gs command</span>
0168 <span class="comment">%  .fontPath - path to the Ghostscript fonts, if any</span>
0169 <span class="comment">%  .libPath - path to the Ghostscript libs (Ghostscript .ps files), if any)</span>
0170 <span class="comment">%  .paperSize - paper size to set for resulting .pdf file</span>
0171 <span class="comment">%  .deletePSFile - 0 to keep (not delete) the input ps file if pdf created ok</span>
0172 <span class="comment">%  .verbose - if non-zero, display some status/progress info to command window</span>
0173 <a name="_sub1" href="#_subfunctions" class="code">function gsData = LocalParseArgs(varargin) </a>
0174     gsData.paperSizes = {<span class="string">'letter'</span>, <span class="string">'ledger'</span>, <span class="string">'legal'</span>, <span class="string">'11x17'</span>, <span class="string">'archA'</span>, <span class="string">'archB'</span>, <span class="keyword">...</span><span class="comment"> </span>
0175                    <span class="string">'archC'</span>, <span class="string">'archD'</span>, <span class="string">'archE'</span>, <span class="string">'a0'</span>, <span class="string">'a1'</span>, <span class="string">'a2'</span>, <span class="string">'a3'</span>,<span class="string">'a4'</span>, <span class="string">'a5'</span>, <span class="keyword">...</span>
0176                    <span class="string">'a6'</span>, <span class="string">'a7'</span>, <span class="string">'a8'</span>, <span class="string">'a9'</span>, <span class="string">'a10'</span>};
0177 
0178     <span class="comment">%default values for some settings</span>
0179     gsData.verbose      = 0; 
0180     gsData.useBuiltin   = 0;
0181     gsData.deletePSFile = 0; 
0182     
0183     <span class="keyword">for</span> i = 1 : 2 : length(varargin)-1 
0184         param_arg = varargin{i};
0185         param_value = varargin{i+1};        
0186         <span class="keyword">switch</span>(lower(param_arg)) 
0187             <span class="comment">% path to ps file to conver</span>
0188             <span class="keyword">case</span> <span class="string">'psfile'</span>
0189                <span class="keyword">if</span> ~exist(param_value, <span class="string">'file'</span>)
0190                   error(<span class="string">'print:ghostscript'</span>, <span class="keyword">...</span>
0191                       <span class="string">'Can not find postscript file &lt;%s&gt; to convert'</span>, <span class="keyword">...</span>
0192                       param_value)
0193                <span class="keyword">end</span>
0194                gsData.psFile = param_value;
0195 
0196             <span class="comment">% path to pdf file to create</span>
0197             <span class="keyword">case</span> <span class="string">'pdffile'</span>
0198                 <span class="comment">%verify we can create file at that location</span>
0199                 pdf_fid = fopen(param_value,<span class="string">'w'</span>);
0200                 <span class="keyword">if</span> pdf_fid &lt; 0 
0201                     error(<span class="string">'ps2pdf:invalidPDFFIle'</span>, <span class="keyword">...</span><span class="comment"> </span>
0202                         <span class="string">'Can not open &lt;%s&gt; for writing'</span>, <span class="keyword">...</span>
0203                         param_value);
0204                 <span class="keyword">end</span>
0205                 fclose(pdf_fid); 
0206                 <span class="comment">%delete temp file we created</span>
0207                 delete(param_value); 
0208                 gsData.pdfFile = param_value;
0209 
0210             <span class="comment">% full path to gs executable</span>
0211             <span class="keyword">case</span> <span class="string">'gscommand'</span> 
0212                <span class="keyword">if</span> ~exist(param_value, <span class="string">'file'</span>)
0213                   error(<span class="string">'ps2pdf:ghostscriptCommand'</span>, <span class="keyword">...</span>
0214                       <span class="string">'Can not find Ghostscript executable (''gscommand'') &lt;%s&gt;'</span>,<span class="keyword">...</span>
0215                       param_value)
0216                <span class="keyword">end</span>
0217                <span class="keyword">if</span> ispc &amp;&amp; ~isempty(findstr(param_value, <span class="string">' '</span>))
0218                    param_value = [<span class="string">'&quot;'</span> param_value <span class="string">'&quot;'</span>]; <span class="comment">%#ok&lt;AGROW&gt;</span>
0219                <span class="keyword">end</span>
0220                gsData.cmd = param_value; 
0221                 
0222             <span class="comment">% full path to gs font dir</span>
0223             <span class="keyword">case</span> <span class="string">'gsfontpath'</span> 
0224                <span class="keyword">if</span> ~exist(param_value, <span class="string">'dir'</span>)
0225                    error(<span class="string">'ps2pdf:ghostscriptFontPath'</span>, <span class="keyword">...</span>
0226                          <span class="string">'Can not find the directory &lt;%s&gt; for Ghostscript fonts (''gsfontpath'')'</span>, <span class="keyword">...</span>
0227                          param_value)
0228                <span class="keyword">end</span>
0229                gsData.fontPath = param_value;
0230 
0231             <span class="comment">% full path to gs lib dir</span>
0232             <span class="keyword">case</span> <span class="string">'gslibpath'</span> 
0233                <span class="keyword">if</span> ~exist(param_value, <span class="string">'dir'</span>)
0234                    error(<span class="string">'ps2pdf:ghostscriptLibPath'</span>, <span class="keyword">...</span>
0235                          <span class="string">'Can not find the directory &lt;%s&gt; for Ghostscript library files (''gslibpath'')'</span>, <span class="keyword">...</span>
0236                          param_value)
0237                <span class="keyword">end</span>
0238                gsData.libPath = param_value;
0239                 
0240             <span class="comment">% paper size</span>
0241             <span class="keyword">case</span> <span class="string">'gspapersize'</span>
0242                idx = strcmpi(param_value, gsData.paperSizes);
0243                <span class="keyword">if</span> ~any(idx)
0244                   warning(<span class="string">'ps2pdf:papersize'</span>, <span class="keyword">...</span>
0245                         <span class="string">'''gspapersize'' value &lt;%s&gt; not found in the list of known sizes, ignoring it.'</span>, param_value);
0246                <span class="keyword">else</span>
0247                   gsData.paperSize = gsData.paperSizes{idx};
0248                <span class="keyword">end</span>
0249 
0250             <span class="comment">% deletePSFile</span>
0251             <span class="keyword">case</span> <span class="string">'deletepsfile'</span>
0252                <span class="keyword">if</span> isnumeric(param_value) 
0253                   gsData.deletePSFile = param_value; 
0254                <span class="keyword">else</span>
0255                    warning(<span class="string">'ps2pdf:deletepsfile'</span>, <span class="keyword">...</span>
0256                          <span class="string">'''deletepsfile'' value &lt;%s&gt; class &lt;%s&gt; should be numeric, defaulting to 0'</span>, <span class="keyword">...</span>
0257                          param_value, class(param_value));
0258                <span class="keyword">end</span>
0259                
0260             <span class="comment">% verbose</span>
0261             <span class="keyword">case</span> <span class="string">'verbose'</span>
0262                <span class="keyword">if</span> isnumeric(param_value) 
0263                   gsData.verbose = param_value; 
0264                <span class="keyword">else</span>
0265                    warning(<span class="string">'ps2pdf:verbose'</span>, <span class="keyword">...</span>
0266                          <span class="string">'''verbose'' value &lt;%s&gt; class &lt;%s&gt; should be numeric, defaulting to 0'</span>, <span class="keyword">...</span>
0267                          param_value, class(param_value));
0268                <span class="keyword">end</span>
0269                
0270             <span class="keyword">otherwise</span>
0271                <span class="keyword">if</span> isnumeric(param_value)
0272                    param_value = num2str(param_value);
0273                <span class="keyword">end</span>
0274                   warning(<span class="string">'ps2pdf:unknown'</span>, <span class="keyword">...</span>
0275                      <span class="string">'ignoring unknown parameter &lt;%s&gt; with value &lt;%s&gt;.'</span>, param_arg, param_value);
0276         <span class="keyword">end</span>
0277     <span class="keyword">end</span>    
0278 
0279     <span class="keyword">if</span> ~isfield(gsData, <span class="string">'psFile'</span>) 
0280         error(<span class="string">'ps2pdf:noInputFile'</span>, <span class="keyword">...</span>
0281                <span class="string">'No input (psfile) file specified'</span>);
0282     <span class="keyword">end</span>
0283     
0284     <span class="keyword">if</span> ~isfield(gsData, <span class="string">'pdfFile'</span>) 
0285         error(<span class="string">'ps2pdf:noOutputFile'</span>, <span class="keyword">...</span>
0286                <span class="string">'No output (pdffile) file specified'</span>);
0287     <span class="keyword">end</span>
0288     
0289     <span class="keyword">if</span> ~isfield(gsData, <span class="string">'cmd'</span>) 
0290         <span class="keyword">if</span> isdeployed
0291             error(<span class="string">'ps2pdf:deployedNeedsGhostscript'</span>, <span class="keyword">...</span>
0292                   <span class="string">'In order to use ''ps2pdf'' in a deployed application you must provide the path to a separate instance of Ghostscript.'</span>);
0293         <span class="keyword">end</span>
0294 
0295         <span class="comment">% updated code to find ghostscript - look for gs8x first,</span>
0296         <span class="comment">% then try old location. Don't depend on MATLAB version #</span>
0297         ghostDir = fullfile( matlabroot, <span class="string">'sys'</span>, <span class="string">'gs8x'</span> );
0298         <span class="keyword">if</span> ~exist(ghostDir, <span class="string">'dir'</span>)
0299             [gsCmd, ghostDir] = <a href="#_sub4" class="code" title="subfunction [gsCmd, ghostDir] = Local_GetOldGhostscript">Local_GetOldGhostscript</a>();
0300             gsData.cmd = gsCmd;
0301         <span class="keyword">else</span>
0302            gsData.cmd = <a href="#_sub3" class="code" title="subfunction gs = Local_GetGscriptFcnHandle()">Local_GetGscriptFcnHandle</a>;
0303            <span class="keyword">if</span> ~isempty(gsData.cmd)
0304               gsData.useBuiltin = 1; <span class="comment">% use builtin Ghostscript</span>
0305            <span class="keyword">end</span>
0306         <span class="keyword">end</span>
0307         <span class="keyword">if</span> ~exist(ghostDir, <span class="string">'dir'</span>)
0308            error(<span class="string">'ps2pdf:ghostscriptCommand'</span>, <span class="keyword">...</span>
0309                  <span class="string">'Can not find Ghostscript installed with MATLAB in &lt;%s&gt;'</span>,<span class="keyword">...</span>
0310                  ghostDir);
0311         <span class="keyword">end</span>
0312 
0313         <span class="keyword">if</span> ~isempty(gsData.cmd)
0314            <span class="comment">% if using MATLAB's version of GhostScript, use same set of fonts and library files</span>
0315            <span class="keyword">if</span> isfield(gsData, <span class="string">'fontPath'</span>) || isfield(gsData, <span class="string">'libPath'</span>)
0316               warning(<span class="string">'ps2pdf:ghostscriptPathOverride'</span>, <span class="keyword">...</span>
0317                     <span class="string">'Using MATLAB''s version of Ghostscript; overriding ''gsfontpath'' and ''gslibpath'' to use builtin MATLAB version'</span>);
0318            <span class="keyword">end</span>
0319            gsData.fontPath = fullfile( ghostDir, <span class="string">'fonts'</span>, <span class="string">''</span>);
0320            gsData.libPath = fullfile( ghostDir, <span class="string">'ps_files'</span>, <span class="string">''</span>);
0321         <span class="keyword">else</span> 
0322             error(<span class="string">'ps2pdf:noGhostscriptCommand'</span>, <span class="keyword">...</span>
0323                   <span class="string">'Can not find Ghostscript program in MATLAB'</span>);
0324         <span class="keyword">end</span>
0325     <span class="keyword">else</span>
0326         <span class="comment">% if gscommandpath was specified,</span>
0327         <span class="keyword">if</span> ~isfield(gsData, <span class="string">'fontPath'</span>) || ~isfield(gsData, <span class="string">'libPath'</span>)
0328            warning(<span class="string">'ps2pdf:ghostscriptCommandSuggestion'</span>, <span class="keyword">...</span>
0329                  [<span class="string">'When specifying a Ghostscript executable (''gscommand'') you should also '</span><span class="keyword">...</span>
0330                  <span class="string">'specify both the ''gsfontpath'' and ''gslibpath'' locations'</span>]);
0331    
0332         <span class="keyword">end</span>
0333     <span class="keyword">end</span>
0334 <span class="keyword">end</span>
0335 
0336 <span class="comment">%local function to create the input file needed for Ghostscript</span>
0337 <a name="_sub2" href="#_subfunctions" class="code">function gsData = LocalCreateResponseFile(gsData) </a>
0338    <span class="comment">% open a response file to write out Ghostscript commands</span>
0339    rsp_file = [tempname <span class="string">'.rsp'</span>];
0340    rsp_fid = fopen (rsp_file, <span class="string">'w'</span>);
0341 
0342    <span class="keyword">if</span> (rsp_fid &lt; 0)
0343       error(<span class="string">'ps2pdf:responseFileCreate'</span>, <span class="string">'Unable to create response file'</span>)
0344    <span class="keyword">end</span>
0345 
0346    fprintf(rsp_fid, <span class="string">'-dBATCH -dNOPAUSE\n'</span>);
0347    <span class="keyword">if</span> ~gsData.verbose
0348        fprintf(rsp_fid, <span class="string">'-q\n'</span>);
0349    <span class="keyword">end</span>
0350    <span class="keyword">if</span> isfield(gsData, <span class="string">'libPath'</span>)
0351       fprintf(rsp_fid, <span class="string">'-I&quot;%s&quot;\n'</span>, gsData.libPath);
0352    <span class="keyword">end</span>
0353    <span class="keyword">if</span> isfield(gsData, <span class="string">'fontPath'</span>)
0354       fprintf(rsp_fid, <span class="string">'-I&quot;%s&quot;\n'</span>, gsData.fontPath);
0355    <span class="keyword">end</span>
0356    <span class="keyword">if</span> isfield(gsData, <span class="string">'paperSize'</span>) 
0357       fprintf( rsp_fid, <span class="string">'-sPAPERSIZE=%s\n'</span>, gsData.paperSize );
0358    <span class="keyword">end</span>
0359    fprintf(rsp_fid, <span class="string">'-sOutputFile=&quot;%s&quot;\n'</span>, gsData.pdfFile);
0360    fprintf(rsp_fid, <span class="string">'-sDEVICE=%s\n'</span>, <span class="string">'pdfwrite'</span>);
0361    fclose(rsp_fid);
0362    gsData.responseFile = rsp_file;
0363 <span class="keyword">end</span>
0364 
0365 <span class="comment">%local function to get a handle to MATLAB's Ghostscript implementation</span>
0366 <span class="comment">%NOTE: this may change or be removed in future releases</span>
0367 <a name="_sub3" href="#_subfunctions" class="code">function gs = Local_GetGscriptFcnHandle()</a>
0368   gs = <span class="string">''</span>;
0369   p = which(<span class="string">'-all'</span>, <span class="string">'gscript'</span>);
0370   <span class="keyword">if</span> ~isempty(p) 
0371       p = p{1};
0372       fpath = fileparts(p);
0373       olddir = cd(fpath);
0374       gs = @gscript;
0375       cd(olddir);
0376   <span class="keyword">end</span>
0377 <span class="keyword">end</span>
0378 
0379 <span class="comment">% local function to try and get location of Ghostscript in older MATLAB</span>
0380 <a name="_sub4" href="#_subfunctions" class="code">function [gsCmd, ghostDir] = Local_GetOldGhostscript</a>
0381    ghostDir = fullfile( matlabroot, <span class="string">'sys'</span>, <span class="string">'ghostscript'</span> );
0382    gsCmd = <span class="string">''</span>;
0383    <span class="keyword">if</span> ispc
0384       <span class="keyword">if</span> exist(fullfile(ghostDir,<span class="string">'bin'</span>,<span class="string">'win32'</span>,<span class="string">'gs.exe'</span>), <span class="string">'file'</span>)
0385          gsCmd = fullfile(ghostDir,<span class="string">'bin'</span>,<span class="string">'win32'</span>,<span class="string">'gs.exe'</span>);
0386       <span class="keyword">end</span>
0387    <span class="keyword">else</span> 
0388       <span class="keyword">if</span> exist(fullfile(ghostDir,<span class="string">'bin'</span>,lower(computer),<span class="string">'gs'</span>), <span class="string">'file'</span>)
0389          gsCmd = fullfile(ghostDir,<span class="string">'bin'</span>,lower(computer), <span class="string">'gs'</span>);
0390       <span class="keyword">end</span>
0391    <span class="keyword">end</span>
0392    gsCmd = [<span class="string">'&quot;'</span> gsCmd <span class="string">'&quot;'</span>];
0393 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 22-Feb-2017 16:35:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>